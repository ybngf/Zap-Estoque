<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug API Produtos</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #000;
            color: #0f0;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { color: #ff0; }
        .success { background: #030; color: #0f0; padding: 15px; margin: 10px 0; border-left: 3px solid #0f0; }
        .error { background: #300; color: #f00; padding: 15px; margin: 10px 0; border-left: 3px solid #f00; }
        .info { background: #001; padding: 15px; margin: 10px 0; border-left: 3px solid #0ff; }
        pre { background: #111; padding: 10px; overflow-x: auto; white-space: pre-wrap; }
        button {
            background: #0f0;
            color: #000;
            padding: 12px 25px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 5px;
        }
        button:hover { background: #0c0; }
    </style>
</head>
<body>

<h1>üîç DEBUG API - PRODUTOS</h1>

<button onclick="testProducts()">1Ô∏è‚É£ Testar GET /api/products</button>
<button onclick="testCategories()">2Ô∏è‚É£ Testar GET /api/categories</button>
<button onclick="testSuppliers()">3Ô∏è‚É£ Testar GET /api/suppliers</button>
<button onclick="testAll()">‚ö° Testar TUDO (Promise.all)</button>

<div id="result"></div>

<script>
const getApiUrl = () => {
    const path = window.location.pathname;
    let cleanPath = path.replace(/\/[^\/]+\.html$/, '');
    if (cleanPath.endsWith('/')) cleanPath = cleanPath.slice(0, -1);
    return cleanPath ? `${cleanPath}/api` : '/api';
};

async function testProducts() {
    const resultDiv = document.getElementById('result');
    const apiUrl = getApiUrl();
    const url = `${apiUrl}/products`;
    
    resultDiv.innerHTML = `<div class="info">Testando: ${url}</div>`;
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        if (response.ok) {
            resultDiv.innerHTML = `
                <div class="success">
                    ‚úÖ GET /api/products - OK<br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Produtos:</strong> ${Array.isArray(data) ? data.length : 'N/A'}<br>
                    <strong>Dados:</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="error">
                    ‚ùå GET /api/products - FALHOU<br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Erro:</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error">
                ‚ùå ERRO ao chamar API<br>
                <strong>URL:</strong> ${url}<br>
                <strong>Erro:</strong> ${error.message}
            </div>
        `;
    }
}

async function testCategories() {
    const resultDiv = document.getElementById('result');
    const apiUrl = getApiUrl();
    const url = `${apiUrl}/categories`;
    
    resultDiv.innerHTML = `<div class="info">Testando: ${url}</div>`;
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        if (response.ok) {
            resultDiv.innerHTML = `
                <div class="success">
                    ‚úÖ GET /api/categories - OK<br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Categorias:</strong> ${Array.isArray(data) ? data.length : 'N/A'}<br>
                    <strong>Dados:</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="error">
                    ‚ùå GET /api/categories - FALHOU<br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Erro:</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error">
                ‚ùå ERRO ao chamar API<br>
                <strong>URL:</strong> ${url}<br>
                <strong>Erro:</strong> ${error.message}
            </div>
        `;
    }
}

async function testSuppliers() {
    const resultDiv = document.getElementById('result');
    const apiUrl = getApiUrl();
    const url = `${apiUrl}/suppliers`;
    
    resultDiv.innerHTML = `<div class="info">Testando: ${url}</div>`;
    
    try {
        const response = await fetch(url);
        const data = await response.json();
        
        if (response.ok) {
            resultDiv.innerHTML = `
                <div class="success">
                    ‚úÖ GET /api/suppliers - OK<br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Fornecedores:</strong> ${Array.isArray(data) ? data.length : 'N/A'}<br>
                    <strong>Dados:</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        } else {
            resultDiv.innerHTML = `
                <div class="error">
                    ‚ùå GET /api/suppliers - FALHOU<br>
                    <strong>Status:</strong> ${response.status}<br>
                    <strong>Erro:</strong>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                </div>
            `;
        }
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error">
                ‚ùå ERRO ao chamar API<br>
                <strong>URL:</strong> ${url}<br>
                <strong>Erro:</strong> ${error.message}
            </div>
        `;
    }
}

async function testAll() {
    const resultDiv = document.getElementById('result');
    const apiUrl = getApiUrl();
    
    resultDiv.innerHTML = `<div class="info">Testando Promise.all (igual ao componente Products)...</div>`;
    
    try {
        const [productsRes, categoriesRes, suppliersRes] = await Promise.all([
            fetch(`${apiUrl}/products`),
            fetch(`${apiUrl}/categories`),
            fetch(`${apiUrl}/suppliers`)
        ]);
        
        const [productsData, categoriesData, suppliersData] = await Promise.all([
            productsRes.json(),
            categoriesRes.json(),
            suppliersRes.json()
        ]);
        
        let html = '<h2 style="color: #0ff">Resultado Promise.all:</h2>';
        
        // Products
        if (productsRes.ok) {
            html += `<div class="success">‚úÖ Products: ${productsData.length} itens</div>`;
        } else {
            html += `<div class="error">‚ùå Products: ${productsRes.status}</div>`;
        }
        
        // Categories
        if (categoriesRes.ok) {
            html += `<div class="success">‚úÖ Categories: ${categoriesData.length} itens</div>`;
        } else {
            html += `<div class="error">‚ùå Categories: ${categoriesRes.status}</div>`;
        }
        
        // Suppliers
        if (suppliersRes.ok) {
            html += `<div class="success">‚úÖ Suppliers: ${suppliersData.length} itens</div>`;
        } else {
            html += `<div class="error">‚ùå Suppliers: ${suppliersRes.status}</div>`;
        }
        
        html += '<h3 style="color: #ff0">Dados completos:</h3>';
        html += `<pre>${JSON.stringify({ products: productsData, categories: categoriesData, suppliers: suppliersData }, null, 2)}</pre>`;
        
        resultDiv.innerHTML = html;
        
    } catch (error) {
        resultDiv.innerHTML = `
            <div class="error">
                ‚ùå Promise.all FALHOU<br>
                <strong>Erro:</strong> ${error.message}<br><br>
                Este √© provavelmente o erro que est√° quebrando o componente Products!
            </div>
        `;
    }
}
</script>

</body>
</html>
